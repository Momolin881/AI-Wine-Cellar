# AI Wine Cellar 功能規劃路線圖

## 待開發功能

---

### 1. 多瓶酒獨立追蹤 (Individual Bottle Tracking)

**問題描述：**
目前數量 > 1 時，以單筆記錄儲存 `quantity: N`，但每瓶酒的狀態可能不同（開瓶/未開瓶、送禮、轉賣等）。

**解決方案：**

#### 資料層
- 新增時若 `quantity > 1`，自動拆分為多筆獨立記錄
- 每瓶獨立追蹤狀態
- 價格按瓶均攤（或可個別設定）
- 可考慮新增 `batch_id` 欄位，標記同一批購入的酒款

#### 顯示層
- 酒窖首頁：相同酒款（同名 + 同年份 + 同酒莊）合併為單張卡片
- 卡片顯示：總數量、狀態摘要（如「2瓶未開/1瓶已開」）
- 點擊卡片：展開「瓶列表」，可個別管理每瓶狀態

#### 影響範圍
- `POST /wine-items` - 拆分邏輯
- `WineHome.jsx` - 合併顯示邏輯
- `WineDetailModal.jsx` - 瓶列表 UI
- 統計計算邏輯調整

---

### 2. 歷史酒款智慧識別 (Historical Wine Recognition)

**功能描述：**
當使用者再次購買曾經買過的酒款，AI 辨識時提供歷史資訊參考。

**用戶流程：**
```
拍照上傳
    ↓
AI 辨識酒標
    ↓
比對歷史資料庫（包含已喝完的酒）
    ↓
發現曾購買過
    ↓
顯示提示訊息 + 舊資料
```

**顯示資訊：**
| 欄位 | 行為 |
|------|------|
| 酒名、酒類、年份等 | 自動帶入 |
| 上次購買價格 | 顯示參考，可編輯新價格（發現變貴/便宜）|
| 購買日期 | 預設當天，顯示上次購買時間供參考 |
| 品飲筆記 | 顯示舊筆記，可新增/編輯 |
| 購買次數 | 顯示「這是您第 N 次購買此酒款」|

**技術實作：**

#### 後端
- 歷史酒款資料保留（`status = consumed/sold/gifted` 的記錄不刪除）
- 新增 API：`GET /wine-items/history/match?name=xxx&vintage=xxx`
- 模糊比對邏輯（酒名相似度、同酒莊同年份等）

#### 前端
- AI 辨識成功後，呼叫歷史比對 API
- 若有匹配，顯示提示 Modal 或區塊
- 使用者可選擇「使用舊資料」或「重新輸入」

#### 影響範圍
- `POST /wine-items/recognize` - 增加歷史比對邏輯
- `AddWineItem.jsx` - 顯示歷史資料提示 UI
- 資料庫查詢優化（歷史記錄索引）

---

### 3. 非酒精飲品與自訂效期 (Non-Alcoholic & Custom Shelf Life)

**功能描述：**
支援非酒精飲品（牛奶、氣泡水等），並允許使用者自訂開瓶後效期。

**技術實作：**

#### 後端 (Backend)
- 在 `wine_items` 資料表新增欄位 `open_shelf_life_days`（整數）
- 此欄位儲存使用者設定的「開瓶後幾天內要喝完」

#### 前端 (Frontend)
新增酒款頁面：
- 「酒類」選單加入「非酒精/調飲」選項
- 新增輸入框「開瓶後效期（天）」
- 當選擇「非酒精」時，可自由輸入天數（例如：牛奶輸入 7，氣泡水輸入 3）
- 即使是紅酒，如果您想特別設定「這瓶只能放 1 天」，也可以填寫此欄位來覆蓋系統預設值

#### 邏輯優先順序
系統計算 "Drink By" 日期的順序調整為：

| 優先級 | 來源 | 範例 |
|--------|------|------|
| 1️⃣ 最高 | 使用者自訂天數 | 使用者輸入「3天」|
| 2️⃣ 中等 | 系統酒類對照表 | 紅酒=5天、威士忌=2年 |
| 3️⃣ 最低 | 保存類型預設值 | 即飲=3天 / 陳年=長效 |

#### 影響範圍
- `wine_items` 資料表 - 新增欄位
- `AddWineItem.jsx` / `EditWineItem.jsx` - 新增輸入框
- 開瓶後效期計算邏輯 - 調整優先順序
- 酒類選單 - 新增「非酒精/調飲」選項

---

### 4. 智慧推薦與品飲筆記 (Smart Recommendations & Tasting Notes)

**功能描述：**
提供品飲建議與個人化推薦，分為兩個顯示位置。

#### A. 酒款詳情頁 - 品飲筆記模板（User 自訂）

讓使用者用結構化模板記錄品飲體驗：

| 模板欄位 | 說明 |
|----------|------|
| 🥃 純飲方式 | 加冰球、室溫、滴水等 |
| 🍹 調酒紀錄 | 試過的調法、配方 |
| 🍫 搭配紀錄 | 喜歡的下酒菜、甜點 |
| ⭐ 個人評分 | 1-5 星評分 |
| 📝 自由筆記 | 香氣、口感、餘韻等 |

#### B. 酒窖首頁 - 酒鬼推薦 / 我的最愛（系統推薦）

**酒鬼推薦**（基於庫存的智慧推薦）：
- 🥃 **純飲指南**：該酒款特性的最佳飲用建議
- 🍹 **創意調酒**：偵測庫存，推薦可調製的酒譜
  - 例：有威士忌 → 推薦 "Highball"（需氣泡水）
- 🍫 **酒食搭配**：推薦適合的下酒菜

**我的最愛**：
- 使用者標記的愛酒清單
- 快速存取常喝的酒款

#### 影響範圍
- `WineDetailModal.jsx` - 新增品飲筆記模板 UI
- `EditWineItem.jsx` - 品飲筆記編輯欄位
- `WineHome.jsx` - 新增「酒鬼推薦」區塊
- 後端 - 推薦演算法、酒譜資料庫
- 資料表 - 新增評分、最愛標記欄位

---

### 5. UI 模式切換 (Display Mode Toggle)

**功能描述：**
提供「輕鬆模式」與「專業模式」切換，滿足不同使用者需求。

**重要：純 UI 層面，不影響資料庫與後端邏輯**

#### 模式比較

| 功能 | 輕鬆模式 (喝酒小白) | 專業模式 (品酒家) |
|------|---------------------|-------------------|
| 酒款基本資訊 | ✅ 顯示 | ✅ 顯示 |
| 酒鬼推薦 | ✅ 顯示（主要功能）| ✅ 顯示 |
| 我的最愛 | ✅ 顯示 | ✅ 顯示 |
| 品飲筆記模板 | ❌ 隱藏或簡化 | ✅ 完整顯示 |
| 評分系統 | ❌ 隱藏 | ✅ 顯示 |
| 專業術語 | 簡化描述 | 完整術語 |

#### 切換位置
- 設定頁面：使用者可隨時切換
- 首次使用：可引導選擇偏好模式

#### 技術實作
- 前端：使用 Context 或 localStorage 儲存模式偏好
- 條件渲染：根據模式顯示/隱藏元件
- 資料庫：不需修改，同一份資料

---

### 6. 相關功能（未來考慮）

- [ ] 酒款收藏清單（想買但還沒買）
- [ ] 價格趨勢追蹤（同款酒的價格變化）
- [ ] 社群分享功能
- [ ] 酒譜資料庫（調酒配方）
- [ ] 食物搭配資料庫

---

## 版本規劃

| 版本 | 功能 | 狀態 |
|------|------|------|
| v0.1.x | MVP - 基本入庫、管理、開瓶追蹤 | ✅ 已上線 |
| v0.2.0 | 非酒精飲品與自訂效期 | 📋 規劃中 |
| v0.3.0 | 多瓶獨立追蹤 | 📋 規劃中 |
| v0.4.0 | 歷史酒款智慧識別 | 📋 規劃中 |
| v0.5.0 | 智慧推薦與品飲筆記 | 📋 規劃中 |
| v0.6.0 | UI 模式切換（輕鬆/專業）| 📋 規劃中 |

---

*最後更新：2026-01-28*
